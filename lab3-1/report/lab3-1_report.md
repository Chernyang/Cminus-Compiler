# lab3-1实验报告

| 小组成员 | 姓名   | 学号       |
| -------- | ------ | ---------- |
| 组长     | 杨城   | PB17111658 |
| 组员     | 缪立君 | PB17111635 |
| 组员     | 李晨昊 | PB17111658 |

## 实验要求

在本次实验中，利用助教提供的框架，修改在 src/cminusc/cminus_builder.cpp 中的成员函数定义来完成遍历C-minus语法树并产生IR的程序。在文件中定义全局变量以方便函数间的值传递。

## 实验难点

实验中遇到哪些挑战

1、识别整型变量和数组变量并分别对其创建存储空间。

2、分类讨论分支语句后是否有其他语句，以解决空基本块报错问题。

3、处理数组变量，并进行下标越界判断。

4、函数参数传递问题以及随之出现的函数调用问题。

5、对逻辑表达式的计算

## 实验设计

请写明为了顺利完成本次实验，加入了哪些亮点设计，并对这些设计进行解释。
可能的阐述方向有:

1. 如何设计全局变量

   1、Function \*func:	在函数声明中指向声明的函数，用于设置基本块时确定各个基本块对应的函数。

   2、Value \*Exp_val:	存储常数的值便于对常数的引用；存储表达式的结果，用于分支判断条件；存储因子的值，用于表达式的计算；存储操作数的值，用于逻辑表达式的计算等各种与值的存储相关的操作。

   3、int stmt_num：	记录当前语句剩余数量，用于判断分支语句、循环语句之后是否还有其他语句存在，来决定其语句基本块的设置和跳转问题。

2. 如何解决实验难点中的问题

   1、产生空的基本块，运行时报错：设置全局变量stmt_num来判断剩余语句，以此决定是否设置之后的基本块。

   2、执行input函数时传进的值错误：发现是函数参数传递的问题，增加了形参的赋值之后得到解决。

   3、分支语句中存在返回语句后，之后的分支跳转会报错：删除了多余的分支跳转指令，分情况设置分支跳转。

   4、使用函数返回值进行赋值时报错：将对函数类型的判断改为一个调用语句，能够正确返回函数的结果，并能用于赋值。

   5、处理逻辑表达式：统一了全局变量来存储其表达式结果。

   6、处理数组下标越界问题：在合适的地方增加分支跳转语句和返回语句，将下标与零比较，完成对下标的处理。


### 实验总结

学习了如何通过遍历语法树产生LLVM IR，对于cminus的语法和各种语句类型有了更深一步的了解。学会了同组员之间合作完成实验，体验了团队合作。在编写代码和debug中学会耐心寻找问题的解决方法。

### 实验反馈

助教的框架代码可以在增加一些注释，便于学生理解和使用其中函数完成代码的补全。
